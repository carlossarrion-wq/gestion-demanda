generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Domain {
  id          String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String  @unique @db.VarChar(100)
  description String?

  @@map("domains")
}

model Status {
  id    String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name  String @unique @db.VarChar(100)
  order Int

  @@map("statuses")
}

model Project {
  id                     String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                   String                  @unique @db.VarChar(50)
  title                  String                  @db.VarChar(255)
  description            String?
  type                   String?                 @db.VarChar(20)
  priority               String                  @db.VarChar(20)
  startDate              DateTime?               @map("start_date") @db.Date
  endDate                DateTime?               @map("end_date") @db.Date
  status                 Int                     @map("status")
  domain                 Int                     @map("domain")
  team                   String                  @db.VarChar(50)
  createdAt              DateTime                @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt              DateTime                @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  assignments            Assignment[]
  projectSkillBreakdowns ProjectSkillBreakdown[]

  @@index([code], map: "idx_projects_code")
  @@index([type], map: "idx_projects_type")
  @@index([status], map: "idx_projects_status")
  @@index([domain], map: "idx_projects_domain")
  @@index([team], map: "idx_projects_team")
  @@map("projects")
}

model Resource {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code            String          @unique @db.VarChar(50)
  name            String          @db.VarChar(255)
  email           String?         @unique @db.VarChar(255)
  team            String          @db.VarChar(50)
  defaultCapacity Int             @default(160) @map("default_capacity")
  active          Boolean         @default(true)
  createdAt       DateTime        @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt       DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  assignments     Assignment[]
  capacities      Capacity[]
  resourceSkills  ResourceSkill[]

  @@index([code], map: "idx_resources_code")
  @@index([active], map: "idx_resources_active")
  @@index([team], map: "idx_resources_team")
  @@map("resources")
}

model ResourceSkill {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  resourceId  String   @map("resource_id") @db.Uuid
  skillName   String   @map("skill_name") @db.VarChar(100)
  proficiency String?  @db.VarChar(20)
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  resource    Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)

  @@unique([resourceId, skillName])
  @@index([resourceId], map: "idx_resource_skills_resource")
  @@index([skillName], map: "idx_resource_skills_skill_name")
  @@map("resource_skills")
}

model ProjectSkillBreakdown {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectId String   @map("project_id") @db.Uuid
  skillName String   @map("skill_name") @db.VarChar(100)
  month     Int
  year      Int
  hours     Decimal  @default(0) @db.Decimal(10, 2)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, skillName, month, year])
  @@index([projectId], map: "idx_psb_project")
  @@index([skillName], map: "idx_psb_skill_name")
  @@index([year, month], map: "idx_psb_period")
  @@map("project_skill_breakdown")
}

model Capacity {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  resourceId String   @map("resource_id") @db.Uuid
  month      Int
  year       Int
  totalHours Decimal  @map("total_hours") @db.Decimal(10, 2)
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt  DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  resource   Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)

  @@unique([resourceId, month, year])
  @@index([resourceId], map: "idx_capacity_resource")
  @@index([year, month], map: "idx_capacity_period")
  @@map("capacity")
}

model Assignment {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectId   String    @map("project_id") @db.Uuid
  resourceId  String?   @map("resource_id") @db.Uuid
  title       String    @db.VarChar(255)
  description String?
  skillName   String?   @map("skill_name") @db.VarChar(100)
  month       Int
  year        Int
  hours       Decimal   @db.Decimal(10, 2)
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  resource    Resource? @relation(fields: [resourceId], references: [id], onDelete: SetNull)

  @@unique([projectId, title, month, year])
  @@index([projectId], map: "idx_assignments_project")
  @@index([resourceId], map: "idx_assignments_resource")
  @@index([year, month], map: "idx_assignments_period")
  @@index([skillName], map: "idx_assignments_skill_name")
  @@map("assignments")
}
