<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificaci贸n de Capacidad - Dashboard Modular</title>
    
    <!-- Modular CSS -->
    <link rel="stylesheet" href="assets/css/base.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/layout.css">
    <link rel="stylesheet" href="assets/css/tabs.css">
    <link rel="stylesheet" href="assets/css/tables.css">
    <link rel="stylesheet" href="assets/css/modal.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
    
    <!-- Handsontable for Excel-like interface -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@14.1.0/dist/handsontable.full.min.css">
    <script src="https://cdn.jsdelivr.net/npm/handsontable@14.1.0/dist/handsontable.full.min.js"></script>
    
    <!-- AG Grid for task management -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/styles/ag-grid.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/styles/ag-theme-alpine.css">
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/dist/ag-grid-community.min.js"></script>
    
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-title">
                <h1>Planificaci贸n de Capacidad</h1>
                <p>Sistema Modular de Gesti贸n de Recursos y Proyectos</p>
            </div>
            <div class="header-user-section">
                <button id="team-name-btn" class="user-info-btn team-btn"></button>
                <div style="position: relative;">
                    <button id="user-initial-btn" class="user-info-btn initial-btn" onclick="toggleUserDropdown()"></button>
                    <div id="user-dropdown" class="user-dropdown">
                        <div class="user-dropdown-header">
                            <div id="dropdown-avatar" class="user-dropdown-avatar"></div>
                            <div class="user-dropdown-info">
                                <div id="dropdown-name" class="user-dropdown-name"></div>
                                <div id="dropdown-email" class="user-dropdown-email"></div>
                            </div>
                        </div>
                        <div class="user-dropdown-divider"></div>
                        <div class="user-dropdown-section">
                            <div class="user-dropdown-item user-dropdown-logout" onclick="logout()">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 20px; height: 20px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 005.25 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9" />
                                </svg>
                                Cerrar Sesi贸n
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="overview-tab">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 20px; height: 20px; margin-right: 8px;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-2.25m-7.5 0h7.5m-7.5 0l-1 3m8.5-3l1 3m0 0l-1-3m1 3l-1-3m-16.5 0h16.5" />
                    </svg>
                    Vista General
                </button>
                <button class="tab-button" data-tab="projects-tab">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 20px; height: 20px; margin-right: 8px;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>
                    Gesti贸n de Proyectos
                </button>
                <button class="tab-button" data-tab="resources-tab">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 20px; height: 20px; margin-right: 8px;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                    </svg>
                    Gesti贸n de Capacidad
                </button>
            </div>
            
            <!-- Vista General Tab -->
            <div id="overview-tab" class="tab-content active">
                <div class="section-header">
                    <h2>Vista General - Dashboard de Capacidad</h2>
                </div>
                
                <div class="period-section">
                    <div class="period-header">
                        <select id="period-selector" class="period-selector">
                            <option value="current">Mes en curso</option>
                            <option value="next">Mes pr贸ximo</option>
                            <option value="next3">3 pr贸ximos meses</option>
                            <option value="next6">6 pr贸ximos meses</option>
                            <option value="next12">12 pr贸ximos meses</option>
                        </select>
                    </div>
                    
                    <!-- KPI Grid -->
                    <div class="kpi-grid-overview">
                        <div class="kpi-card">
                            <div class="kpi-header">
                                <span class="kpi-label">PROYECTOS ACTIVOS</span>
                                <span class="kpi-trend positive" id="proyectos-activos-trend">+17%</span>
                            </div>
                            <div class="kpi-value" id="proyectos-activos">7</div>
                            <div class="kpi-subtitle">total proyectos</div>
                            <div class="kpi-details">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Evolutivos:</span>
                                    <span style="font-weight: 600; color: #509594;" id="evolutivos">3</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Proyectos:</span>
                                    <span style="font-weight: 600; color: #509594;" id="proyectos">4</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-header">
                                <span class="kpi-label">RECURSOS ACTIVOS</span>
                                <span class="kpi-trend positive" id="recursos-activos-trend">+20%</span>
                            </div>
                            <div class="kpi-value" id="recursos-activos">12</div>
                            <div class="kpi-subtitle">total recursos</div>
                            <div class="kpi-details">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Recursos Asignados >50%:</span>
                                    <span style="font-weight: 600; color: #509594;" id="recursos-asignados">9</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Recursos Asignados >80%:</span>
                                    <span style="font-weight: 600; color: #509594;" id="recursos-asignados-80">3</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-header">
                                <span class="kpi-label">CAPACIDAD TOTAL</span>
                                <span class="kpi-trend positive">+5%</span>
                            </div>
                            <div class="kpi-value" id="capacidad-total">1.920</div>
                            <div class="kpi-subtitle">horas disponibles</div>
                            <div class="kpi-details">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>FTEs Equivalentes:</span>
                                    <span style="font-weight: 600; color: #509594;" id="capacidad-ftes-equivalentes">12.0</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-header">
                                <span class="kpi-label">UTILIZACIN ACTUAL</span>
                                <span class="kpi-trend warning" id="utilizacion-trend">78%</span>
                            </div>
                            <div class="kpi-value" id="utilizacion-actual">1.496</div>
                            <div class="kpi-subtitle">horas comprometidas</div>
                            <div class="kpi-details">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>FTEs Equivalentes:</span>
                                    <span style="font-weight: 600; color: #509594;" id="utilizacion-ftes-equivalentes">9.4</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-header">
                                <span class="kpi-label">EFICIENCIA</span>
                                <span class="kpi-trend positive">+12%</span>
                            </div>
                            <div class="kpi-value" id="eficiencia">92%</div>
                            <div class="kpi-subtitle">recursos optimizados</div>
                            <div class="kpi-details">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>FTEs Ineficiencia Equivalentes:</span>
                                    <span style="font-weight: 600; color: #509594;" id="ftes-ineficiencia-equivalentes">2.65</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts Grid -->
                    <div class="charts-grid-overview">
                        <div class="chart-card">
                            <h4>Horas Comprometidas vs Disponibles</h4>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="overview-committed-hours-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <h4>Horas Comprometidas por Perfil</h4>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="overview-skill-distribution-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <h4>Horas Comprometidas por Perfil y Tipo</h4>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="overview-capacity-by-profile-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top 5 Projects -->
                <div class="card" style="margin-top: 2rem;">
                    <h3 style="margin-bottom: 1.5rem;">Top 5 Proyectos por Volumen de Horas</h3>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th style="text-align: left;">ID</th>
                                    <th style="text-align: left;">T铆tulo</th>
                                    <th style="text-align: left;">Descripci贸n</th>
                                    <th style="text-align: left;">Dominio Principal</th>
                                    <th style="text-align: center;">Prioridad Negocio</th>
                                    <th style="text-align: right;">Volumen de Horas</th>
                                    <th style="text-align: right;">Horas Incurridas</th>
                                    <th style="text-align: right;">% Incurrido</th>
                                    <th style="text-align: center;">Estado</th>
                                </tr>
                            </thead>
                            <tbody id="top-projects-table-body">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Matriz de Utilizaci贸n (movida desde pesta帽a separada) -->
                <div class="section-header" style="margin-top: 3rem;">
                    <h2>Matriz de Utilizaci贸n</h2>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="card" style="min-width: 0;">
                        <h3>Proyectos Registrados</h3>
                        <div style="font-size: 2.5rem; font-weight: 600; color: #319795; margin: 1rem 0;" id="matrix-total-projects">7</div>
                        <div style="color: #718096; margin-bottom: 0.75rem;">Total proyectos</div>
                        <div style="display: flex; justify-content: space-around; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e2e8f0;">
                            <div style="text-align: center;">
                                <div style="font-size: 1.25rem; font-weight: 600; color: #3182ce;" id="matrix-evolutivos-count">3</div>
                                <div style="font-size: 0.75rem; color: #718096;">Evolutivos</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.25rem; font-weight: 600; color: #319795;" id="matrix-proyectos-count">4</div>
                                <div style="font-size: 0.75rem; color: #718096;">Proyectos</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="min-width: 0;">
                        <h3>Media Horas por Proyecto</h3>
                        <div style="font-size: 2.5rem; font-weight: 600; color: #319795; margin: 1rem 0;" id="matrix-avg-hours-project">914</div>
                        <div style="color: #718096; margin-bottom: 0.75rem;">horas promedio</div>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem; font-size: 0.85rem; color: #4a5568;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Media Evolutivos:</span>
                                <span style="font-weight: 600; color: #319795;" id="matrix-avg-evolutivos">640</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Media Proyectos:</span>
                                <span style="font-weight: 600; color: #319795;" id="matrix-avg-proyectos">1.120</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="min-width: 0;">
                        <h3>Volumen de Horas por Tipo</h3>
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="matrix-hours-by-type-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2>Planificaci贸n de Recursos por Proyecto y Mes</h2>
                    <div class="capacity-matrix">
                        <table>
                            <thead>
                                <tr>
                                    <th class="project-name">Proyecto</th>
                                    <th>Tipo</th>
                                    <th>Dominio principal</th>
                                    <th>Ene 2026</th>
                                    <th>Feb 2026</th>
                                    <th>Mar 2026</th>
                                    <th>Abr 2026</th>
                                    <th>May 2026</th>
                                    <th>Jun 2026</th>
                                    <th>Jul 2026</th>
                                    <th>Ago 2026</th>
                                    <th>Sep 2026</th>
                                    <th>Oct 2026</th>
                                    <th>Nov 2026</th>
                                    <th>Dic 2026</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="project-row" data-project="NC-249">
                                    <td class="project-name">
                                        <span class="expand-icon" data-project="NC-249">+</span>
                                        <strong>NC-249</strong> - Soporte...
                                    </td>
                                    <td>Proyecto</td>
                                    <td>Operaci贸n de Sistemas y Ciberseguridad</td>
                                    <td><span class="capacity-cell empty" data-project="NC-249" data-month="ene" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-249" data-month="feb" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-249" data-month="mar" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-249" data-month="abr" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-249" data-month="may" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell medium" data-project="NC-249" data-month="jun" title="320 horas">320</span></td>
                                    <td><span class="capacity-cell low" data-project="NC-249" data-month="jul" title="160 horas">160</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-249" data-month="ago" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-249" data-month="sep" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-249" data-month="oct" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-249" data-month="nov" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-249" data-month="dic" title="0 horas">-</span></td>
                                </tr>
                                <tr class="project-row" data-project="NC-15">
                                    <td class="project-name">
                                        <span class="expand-icon" data-project="NC-15">+</span>
                                        <strong>NC-15</strong> - Modelo datos: Fase 2
                                    </td>
                                    <td>Proyecto</td>
                                    <td>Atenci贸n</td>
                                    <td><span class="capacity-cell empty" data-project="NC-15" data-month="ene" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-15" data-month="feb" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-15" data-month="mar" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-15" data-month="abr" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-15" data-month="may" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell low" data-project="NC-15" data-month="jun" title="160 horas">160</span></td>
                                    <td><span class="capacity-cell medium" data-project="NC-15" data-month="jul" title="320 horas">320</span></td>
                                    <td><span class="capacity-cell low" data-project="NC-15" data-month="ago" title="160 horas">160</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-15" data-month="sep" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-15" data-month="oct" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-15" data-month="nov" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-15" data-month="dic" title="0 horas">-</span></td>
                                </tr>
                                <tr class="project-row" data-project="NC-16">
                                    <td class="project-name">
                                        <span class="expand-icon" data-project="NC-16">+</span>
                                        <strong>NC-16</strong> - Pricing...
                                    </td>
                                    <td>Proyecto</td>
                                    <td>Facturaci贸n y Cobros</td>
                                    <td><span class="capacity-cell empty" data-project="NC-16" data-month="ene" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-16" data-month="feb" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-16" data-month="mar" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-16" data-month="abr" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-16" data-month="may" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell medium" data-project="NC-16" data-month="jun" title="320 horas">320</span></td>
                                    <td><span class="capacity-cell high" data-project="NC-16" data-month="jul" title="480 horas">480</span></td>
                                    <td><span class="capacity-cell high" data-project="NC-16" data-month="ago" title="480 horas">480</span></td>
                                    <td><span class="capacity-cell medium" data-project="NC-16" data-month="sep" title="320 horas">320</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-16" data-month="oct" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-16" data-month="nov" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-16" data-month="dic" title="0 horas">-</span></td>
                                </tr>
                                <tr class="project-row" data-project="NC-17">
                                    <td class="project-name">
                                        <span class="expand-icon" data-project="NC-17">+</span>
                                        <strong>NC-17</strong> - Direcciones...
                                    </td>
                                    <td>Proyecto</td>
                                    <td>Atenci贸n</td>
                                    <td><span class="capacity-cell empty" data-project="NC-17" data-month="ene" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-17" data-month="feb" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-17" data-month="mar" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-17" data-month="abr" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-17" data-month="may" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell low" data-project="NC-17" data-month="jun" title="160 horas">160</span></td>
                                    <td><span class="capacity-cell medium" data-project="NC-17" data-month="jul" title="320 horas">320</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-17" data-month="ago" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-17" data-month="sep" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-17" data-month="oct" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-17" data-month="nov" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-17" data-month="dic" title="0 horas">-</span></td>
                                </tr>
                                <tr class="project-row" data-project="NC-18">
                                    <td class="project-name">
                                        <span class="expand-icon" data-project="NC-18">+</span>
                                        <strong>NC-18</strong> - Ampliar...
                                    </td>
                                    <td>Evolutivo</td>
                                    <td>Integraci贸n</td>
                                    <td><span class="capacity-cell empty" data-project="NC-18" data-month="ene" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-18" data-month="feb" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-18" data-month="mar" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-18" data-month="abr" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-18" data-month="may" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell low" data-project="NC-18" data-month="jun" title="160 horas">160</span></td>
                                    <td><span class="capacity-cell low" data-project="NC-18" data-month="jul" title="160 horas">160</span></td>
                                    <td><span class="capacity-cell medium" data-project="NC-18" data-month="ago" title="320 horas">320</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-18" data-month="sep" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-18" data-month="oct" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-18" data-month="nov" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-18" data-month="dic" title="0 horas">-</span></td>
                                </tr>
                                <tr class="project-row" data-project="NC-19">
                                    <td class="project-name">
                                        <span class="expand-icon" data-project="NC-19">+</span>
                                        <strong>NC-19</strong> - Securizaci贸n de email
                                    </td>
                                    <td>Proyecto</td>
                                    <td>Datos</td>
                                    <td><span class="capacity-cell empty" data-project="NC-19" data-month="ene" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-19" data-month="feb" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-19" data-month="mar" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-19" data-month="abr" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-19" data-month="may" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-19" data-month="jun" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-19" data-month="jul" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell low" data-project="NC-19" data-month="ago" title="160 horas">160</span></td>
                                    <td><span class="capacity-cell medium" data-project="NC-19" data-month="sep" title="320 horas">320</span></td>
                                    <td><span class="capacity-cell high" data-project="NC-19" data-month="oct" title="480 horas">480</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-19" data-month="nov" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-19" data-month="dic" title="0 horas">-</span></td>
                                </tr>
                                <tr class="project-row" data-project="NC-20">
                                    <td class="project-name">
                                        <span class="expand-icon" data-project="NC-20">+</span>
                                        <strong>NC-20</strong> - Actuaciones...
                                    </td>
                                    <td>Evolutivo</td>
                                    <td>Ventas | Contrataci贸n y SW</td>
                                    <td><span class="capacity-cell empty" data-project="NC-20" data-month="ene" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-20" data-month="feb" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-20" data-month="mar" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-20" data-month="abr" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-20" data-month="may" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-20" data-month="jun" title="0 horas">-</span></td>
                                    <td><span class="capacity-cell low" data-project="NC-20" data-month="jul" title="160 horas">160</span></td>
                                    <td><span class="capacity-cell medium" data-project="NC-20" data-month="ago" title="320 horas">320</span></td>
                                    <td><span class="capacity-cell high" data-project="NC-20" data-month="sep" title="480 horas">480</span></td>
                                    <td><span class="capacity-cell high" data-project="NC-20" data-month="oct" title="480 horas">480</span></td>
                                    <td><span class="capacity-cell medium" data-project="NC-20" data-month="nov" title="320 horas">320</span></td>
                                    <td><span class="capacity-cell empty" data-project="NC-20" data-month="dic" title="0 horas">-</span></td>
                                </tr>
                                <tr class="summary-row">
                                    <td class="project-name"><strong>TOTAL HORAS</strong></td>
                                    <td colspan="2"></td>
                                    <td><strong>0</strong></td>
                                    <td><strong>0</strong></td>
                                    <td><strong>0</strong></td>
                                    <td><strong>0</strong></td>
                                    <td><strong>0</strong></td>
                                    <td><strong>1.120</strong></td>
                                    <td><strong>1.600</strong></td>
                                    <td><strong>1.440</strong></td>
                                    <td><strong>1.120</strong></td>
                                    <td><strong>960</strong></td>
                                    <td><strong>320</strong></td>
                                    <td><strong>0</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Drill Down Section -->
                    <div id="drill-down-section" style="margin-top: 2rem; display: none;">
                        <h3>Detalle por Tipolog铆a de Recursos</h3>
                        <div id="drill-down-content">
                            <!-- Content will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Insights and Recommendations (movida al final) -->
                <div class="insights-recommendations-section" style="margin-top: 3rem;">
                    <div class="insights-card">
                        <div class="insights-header">
                            <h3>Insights de Capacidad</h3>
                            <div class="ai-badge"> IA</div>
                        </div>
                        
                        <div class="insight-item">
                            <div class="insight-icon"></div>
                            <div class="insight-content">
                                <div class="insight-title">Tendencia Positiva</div>
                                <div class="insight-text">La eficiencia del equipo ha mejorado 12% este trimestre.</div>
                            </div>
                        </div>
                        
                        <div class="insight-item">
                            <div class="insight-icon"></div>
                            <div class="insight-content">
                                <div class="insight-title">Cuello de Botella</div>
                                <div class="insight-text">Los recursos de QA est谩n al 95% de utilizaci贸n.</div>
                            </div>
                        </div>
                        
                        <div class="insight-item">
                            <div class="insight-icon"></div>
                            <div class="insight-content">
                                <div class="insight-title">Oportunidad</div>
                                <div class="insight-text">3 recursos con skills de An谩lisis est谩n subutilizados.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recommendations-card">
                        <div class="recommendations-header">
                            <h3>Recomendaciones Estrat茅gicas</h3>
                            <div class="score-badge">Score: 8.2/10</div>
                        </div>
                        
                        <div class="recommendation-item high-priority">
                            <span class="priority-badge alta">Alta</span>
                            <div class="recommendation-content">
                                <div class="recommendation-title">Contratar QA Specialist</div>
                                <div class="recommendation-text">Incorporar 1 FTE de QA antes de Q3.</div>
                                <div class="recommendation-impact">Impacto: +15% velocidad entrega</div>
                            </div>
                        </div>
                        
                        <div class="recommendation-item medium-priority">
                            <span class="priority-badge media">Media</span>
                            <div class="recommendation-content">
                                <div class="recommendation-title">Cross-training en An谩lisis</div>
                                <div class="recommendation-text">Formar 2 desarrolladores en skills de an谩lisis.</div>
                                <div class="recommendation-impact">Impacto: +20% flexibilidad</div>
                            </div>
                        </div>
                        
                        <div class="recommendation-item low-priority">
                            <span class="priority-badge baja">Baja</span>
                            <div class="recommendation-content">
                                <div class="recommendation-title">Redistribuir Carga Q4</div>
                                <div class="recommendation-text">Mover NC-19 a Q1 2026 para equilibrar carga.</div>
                                <div class="recommendation-impact">Impacto: -12% riesgo sobrecarga</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Resources Tab -->
            <div id="resources-tab" class="tab-content">
                <div class="section-header">
                    <h2>Gesti贸n de Capacidad</h2>
                </div>
                
                <!-- KPIs and Charts Row for Resources -->
                <div style="display: grid; grid-template-columns: 250px 250px 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="card">
                        <h3>Recursos Registrados</h3>
                        <div style="font-size: 2.5rem; font-weight: 600; color: #319795; margin: 1rem 0;" data-kpi="total-resources">0</div>
                        <div style="color: #718096; margin-bottom: 0.75rem;">Total recursos</div>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem; font-size: 0.85rem; color: #4a5568;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Con asignaci贸n a futuro:</span>
                                <span style="font-weight: 600; color: #319795;" data-kpi="with-assignment">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Sin asignaci贸n a futuro:</span>
                                <span style="font-weight: 600; color: #319795;" data-kpi="without-assignment">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Ratio de Ocupaci贸n Medio</h3>
                        <div style="font-size: 2.5rem; font-weight: 600; color: #319795; margin: 1rem 0;" id="resources-avg-occupation-ratio">0%</div>
                        <div style="color: #718096; margin-bottom: 0.75rem;">Promedio del equipo</div>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem; font-size: 0.85rem; color: #4a5568;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Mes Actual:</span>
                                <span style="font-weight: 600; color: #319795;" data-kpi="current-utilization">0%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>A futuro:</span>
                                <span style="font-weight: 600; color: #319795;" data-kpi="future-utilization">0%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Horas Comprometidas vs Disponibles</h3>
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="monthly-comparison-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Horas potenciales disponibles por perfil</h3>
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="skills-availability-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Matriz de Recursos -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="margin-bottom: 0;">Matriz de Recursos por Mes</h2>
                        <button class="btn btn-primary" id="add-resource-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 20px; height: 20px;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                            </svg>
                            A帽adir Recurso
                        </button>
                    </div>
                    <div class="capacity-matrix">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 40px; min-width: 40px;"></th>
                                    <th class="project-name" style="min-width: 150px;">Recurso</th>
                                    <th style="min-width: 100px;">Ratio de Ocupaci贸n</th>
                                    <th style="min-width: 120px;">Skills</th>
                                    <th style="min-width: 80px;">ENE 2026</th>
                                    <th style="min-width: 80px;">FEB 2026</th>
                                    <th style="min-width: 80px;">MAR 2026</th>
                                    <th style="min-width: 80px;">ABR 2026</th>
                                    <th style="min-width: 80px;">MAY 2026</th>
                                    <th style="min-width: 80px;">JUN 2026</th>
                                    <th style="min-width: 80px;">JUL 2026</th>
                                    <th style="min-width: 80px;">AGO 2026</th>
                                    <th style="min-width: 80px;">SEP 2026</th>
                                    <th style="min-width: 80px;">OCT 2026</th>
                                    <th style="min-width: 80px;">NOV 2026</th>
                                    <th style="min-width: 80px;">DIC 2026</th>
                                </tr>
                            </thead>
                            <tbody id="capacity-table-body">
                                <!-- Populated dynamically by resourceCapacity.js -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Projects Tab -->
            <div id="projects-tab" class="tab-content">
                <div class="section-header">
                    <h2>Gesti贸n de Proyectos</h2>
                </div>
                
                <!-- Charts Grid -->
                <div style="display: grid; grid-template-columns: 250px repeat(3, minmax(0, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="card">
                        <h3>Proyectos Registrados</h3>
                        <div style="font-size: 2.5rem; font-weight: 600; color: #319795; margin: 1rem 0;" id="projects-total-count">7</div>
                        <div style="color: #718096; margin-bottom: 0.75rem;">Total proyectos</div>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem; font-size: 0.85rem; color: #4a5568;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Evolutivos:</span>
                                <span style="font-weight: 600; color: #319795;" id="projects-evolutivos-count">3</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Proyectos:</span>
                                <span style="font-weight: 600; color: #319795;" id="projects-proyectos-count">4</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Por Estado</h3>
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="projects-by-status-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Por Dominio Principal</h3>
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="projects-by-domain-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Por Prioridad</h3>
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="projects-by-priority-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="margin-bottom: 0;">Proyectos Planificados</h2>
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn btn-primary" id="add-project-btn" title="A帽adir Proyecto">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 20px; height: 20px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                                </svg>
                                A帽adir Proyecto
                            </button>
                            <button class="btn btn-primary" id="import-jira-btn" title="Importar desde Jira">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 20px; height: 20px;">
                                    <path d="M11.53 2c0 2.4 1.97 4.35 4.35 4.35h1.78v1.7c0 2.4 1.97 4.35 4.35 4.35V2.84a.84.84 0 0 0-.84-.84H11.53zM6.77 6.8c0 2.4 1.97 4.35 4.35 4.35h1.78v1.7c0 2.4 1.97 4.35 4.35 4.35V7.64a.84.84 0 0 0-.84-.84H6.77zM2 11.6c0 2.4 1.97 4.35 4.35 4.35h1.78v1.7c0 2.4 1.97 4.35 4.35 4.35v-9.56a.84.84 0 0 0-.84-.84H2z"/>
                                </svg>
                                Importar desde Jira
                            </button>
                        </div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <input type="text" id="project-search" class="form-control" placeholder="Buscar proyectos..." style="max-width: 300px; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 0.375rem;">
                    </div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>T铆tulo</th>
                                    <th>Descripci贸n</th>
                                    <th>Dominio Principal</th>
                                    <th>Prioridad Negocio</th>
                                    <th>Fecha Inicio</th>
                                    <th>Fecha Fin</th>
                                    <th>Estado</th>
                                    <th>Tipo</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="projects-table-body">
                                <tr>
                                    <td><strong>NC-249</strong></td>
                                    <td>Soporte incorporaci贸n Tercer proveedor Call Center</td>
                                    <td>Integraci贸n de nuevo proveedor para...</td>
                                    <td>Operaci贸n de Sistemas y Ciberseguridad</td>
                                    <td><span class="priority-badge alta">Alta</span></td>
                                    <td>2026-06-06</td>
                                    <td>2026-07-01</td>
                                    <td><span class="status-badge finalizado">Finalizado</span></td>
                                    <td>Proyecto</td>
                                    <td>
                                        <span class="action-icon" data-action="edit" data-project="NC-249" title="Editar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                                            </svg>
                                        </span>
                                        <span class="action-icon" data-action="tasks" data-project="NC-249" title="Gesti贸n de Tareas">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                                            </svg>
                                        </span>
                                        <span class="action-icon" data-action="resources" data-project="NC-249" title="Asignaci贸n de Recursos">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                                            </svg>
                                        </span>
                                        <span class="action-icon" data-action="delete" data-project="NC-249" title="Eliminar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                                            </svg>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>NC-15</strong></td>
                                    <td>Modelo datos: Fase 2</td>
                                    <td>Desarrollo del modelo de datos...</td>
                                    <td>Atenci贸n</td>
                                    <td><span class="priority-badge media">Media</span></td>
                                    <td>2026-06-06</td>
                                    <td>2026-08-15</td>
                                    <td><span class="status-badge finalizado">Finalizado</span></td>
                                    <td>Evolutivo</td>
                                    <td>
                                        <span class="action-icon" data-action="edit" data-project="NC-15" title="Editar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                                            </svg>
                                        </span>
                                        <span class="action-icon" data-action="tasks" data-project="NC-15" title="Gesti贸n de Tareas">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                                            </svg>
                                        </span>
                                        <span class="action-icon" data-action="resources" data-project="NC-15" title="Asignaci贸n de Recursos">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                                            </svg>
                                        </span>
                                        <span class="action-icon" data-action="delete" data-project="NC-15" title="Eliminar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                                            </svg>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>NC-16</strong></td>
                                    <td>Pricing Fases 0 y 1 (Consulta Omega e Hist贸rico Precios)</td>
                                    <td>Implementaci贸n sistema pricing...</td>
                                    <td>Facturaci贸n y Cobros</td>
                                    <td><span class="priority-badge muy-alta">Muy Alta</span></td>
                                    <td>2026-06-06</td>
                                    <td>2026-09-30</td>
                                    <td><span class="status-badge desarrollo">Desarrollo</span></td>
                                    <td>Proyecto</td>
                                    <td>
                                        <span class="action-icon" data-action="edit" data-project="NC-16" title="Editar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                                            </svg>
                                        </span>
                                        <span class="action-icon" data-action="delete" data-project="NC-16" title="Eliminar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                                            </svg>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>NC-17</strong></td>
                                    <td>Direcciones: corresp. & fiscal</td>
                                    <td>Gesti贸n de direcciones de...</td>
                                    <td>Atenci贸n</td>
                                    <td><span class="priority-badge media">Media</span></td>
                                    <td>2026-06-06</td>
                                    <td>2026-07-31</td>
                                    <td><span class="status-badge diseno-detallado">Dise帽o Detallado</span></td>
                                    <td>Evolutivo</td>
                                    <td>
                                        <span class="action-icon" data-action="edit" data-project="NC-17" title="Editar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                                            </svg>
                                        </span>
                                        <span class="action-icon" data-action="delete" data-project="NC-17" title="Eliminar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                                            </svg>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>NC-18</strong></td>
                                    <td>Ampliar licencias/Partner comunity en SF</td>
                                    <td>Ampliaci贸n de licencias para...</td>
                                    <td>Integraci贸n</td>
                                    <td><span class="priority-badge baja">Baja</span></td>
                                    <td>2026-06-06</td>
                                    <td>2026-08-30</td>
                                    <td><span class="status-badge desarrollo">Desarrollo</span></td>
                                    <td>Evolutivo</td>
                                    <td>
                                        <span class="action-icon" data-action="edit" data-project="NC-18" title="Editar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                                            </svg>
                                        </span>
                                        <span class="action-icon" data-action="delete" data-project="NC-18" title="Eliminar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                                            </svg>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>NC-19</strong></td>
                                    <td>Securizaci贸n de email</td>
                                    <td>Implementaci贸n de medidas de...</td>
                                    <td>Datos</td>
                                    <td><span class="priority-badge alta">Alta</span></td>
                                    <td>2026-06-06</td>
                                    <td>2026-10-15</td>
                                    <td><span class="status-badge diseno-detallado">Dise帽o Detallado</span></td>
                                    <td>Proyecto</td>
                                    <td>
                                        <span class="action-icon" data-action="edit" data-project="NC-19" title="Editar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                                            </svg>
                                        </span>
                                        <span class="action-icon" data-action="delete" data-project="NC-19" title="Eliminar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                                            </svg>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>NC-20</strong></td>
                                    <td>Actuaciones para asegurar el plan de aceleraci贸n de Portabilidad</td>
                                    <td>Plan de aceleraci贸n para...</td>
                                    <td>Ventas | Contrataci贸n y SW</td>
                                    <td><span class="priority-badge muy-alta">Muy Alta</span></td>
                                    <td>2026-06-06</td>
                                    <td>2026-11-30</td>
                                    <td><span class="status-badge desarrollo">Desarrollo</span></td>
                                    <td>Proyecto</td>
                                    <td>
                                        <span class="action-icon" data-action="edit" data-project="NC-20" title="Editar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                                            </svg>
                                        </span>
                                        <span class="action-icon" data-action="delete" data-project="NC-20" title="Eliminar">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                                            </svg>
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination Container -->
                    <div id="pagination-container" class="pagination-container"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Authentication Check Script -->
    <script>
        // Check authentication on page load
        (function() {
            const isAuthenticated = sessionStorage.getItem('user_authenticated');
            
            if (isAuthenticated !== 'true') {
                // Not authenticated, redirect to login
                window.location.href = 'login.html';
                return;
            }
            
            // User is authenticated, populate user information dynamically
            const username = sessionStorage.getItem('username') || 'Usuario';
            const userFullName = sessionStorage.getItem('user_full_name') || username;
            const userTeam = sessionStorage.getItem('user_team');
            const userTeamFull = sessionStorage.getItem('user_team_full');
            const userEmail = sessionStorage.getItem('user_email') || 'usuario@example.com';
            
            // Populate team button with user's team keyword (DYNAMIC)
            const teamBtn = document.getElementById('team-name-btn');
            if (teamBtn && userTeam) {
                teamBtn.textContent = userTeam.toUpperCase();
            } else if (teamBtn && userTeamFull) {
                // Fallback to full team name if keyword not available
                teamBtn.textContent = userTeamFull;
            }
            
            // Populate initial button with user's first initial (DYNAMIC)
            const initialBtn = document.getElementById('user-initial-btn');
            if (initialBtn && userFullName) {
                initialBtn.textContent = userFullName.charAt(0).toUpperCase();
            }
            
            // Populate dropdown with user information
            const dropdownAvatar = document.getElementById('dropdown-avatar');
            if (dropdownAvatar && userFullName) {
                dropdownAvatar.textContent = userFullName.charAt(0).toUpperCase();
            }
            
            const dropdownName = document.getElementById('dropdown-name');
            if (dropdownName) {
                dropdownName.textContent = userFullName;
            }
            
            const dropdownEmail = document.getElementById('dropdown-email');
            if (dropdownEmail) {
                dropdownEmail.textContent = userEmail;
            }
            
            // Optional: Log authentication info for debugging
            console.log('User authenticated:', {
                username: username,
                fullName: userFullName,
                team: userTeam,
                email: userEmail,
                loginTime: sessionStorage.getItem('login_timestamp')
            });
        })();
        
        // Toggle user dropdown visibility
        function toggleUserDropdown() {
            const dropdown = document.getElementById('user-dropdown');
            if (dropdown) {
                const isVisible = dropdown.style.display === 'block';
                dropdown.style.display = isVisible ? 'none' : 'block';
            }
        }
        
        // Logout function
        function logout() {
            // Clear session storage
            sessionStorage.clear();
            
            // Redirect to login
            window.location.href = 'login.html';
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('user-dropdown');
            const initialBtn = document.getElementById('user-initial-btn');
            
            if (dropdown && initialBtn) {
                // Check if click is outside both the button and dropdown
                if (!initialBtn.contains(event.target) && !dropdown.contains(event.target)) {
                    dropdown.style.display = 'none';
                }
            }
        });
    </script>

    <!-- Project Modal -->
    <div id="projectModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="modalTitle">A帽adir Proyecto</h2>
                <button class="modal-close" onclick="closeProjectModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="projectForm">
                    <input type="hidden" id="projectId" name="id">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectCode">ID Proyecto <span class="required">*</span></label>
                            <input type="text" id="projectCode" name="code" class="form-control" placeholder="Ej: NC-249" required>
                            <small class="form-help">Formato sugerido: NC-XXX (ej: NC-249)</small>
                            <div class="form-error" id="projectCodeError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="projectType">Tipo</label>
                            <select id="projectType" name="type" class="form-control">
                                <option value="">-- Seleccionar --</option>
                                <option value="Proyecto">Proyecto</option>
                                <option value="Evolutivo">Evolutivo</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="projectTitle">T铆tulo <span class="required">*</span></label>
                        <input type="text" id="projectTitle" name="title" class="form-control" placeholder="T铆tulo del proyecto" required>
                        <small class="form-help">M铆nimo 5 caracteres</small>
                        <div class="form-error" id="projectTitleError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="projectDescription">Descripci贸n <span class="required">*</span></label>
                        <textarea id="projectDescription" name="description" class="form-control" rows="3" placeholder="Descripci贸n detallada del proyecto" required></textarea>
                        <small class="form-help">M铆nimo 10 caracteres</small>
                        <div class="form-error" id="projectDescriptionError"></div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectDomain">Dominio Principal <span class="required">*</span></label>
                            <select id="projectDomain" name="domain" class="form-control" required>
                                <option value="">-- Seleccionar Dominio --</option>
                                <option value="1">Atenci贸n</option>
                                <option value="2">Datos</option>
                                <option value="3">Facturaci贸n y Cobros</option>
                                <option value="4">Ciclo de Vida y Producto</option>
                                <option value="5">Operaci贸n de Sistemas y Ciberseguridad</option>
                                <option value="6">Ventas | Contrataci贸n y SW</option>
                                <option value="7">Portabilidad</option>
                                <option value="8">Integraci贸n</option>
                                <option value="9">Industrial</option>
                                <option value="10">Gen. Distribuida</option>
                                <option value="11">IA Gen</option>
                                <option value="12">Ninguno</option>
                            </select>
                            <div class="form-error" id="projectDomainError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="projectPriority">Prioridad <span class="required">*</span></label>
                        <select id="projectPriority" name="priority" class="form-control" required>
                            <option value="">-- Seleccionar Prioridad --</option>
                            <option value="Muy Alta">Muy Alta</option>
                            <option value="Alta">Alta</option>
                            <option value="Media">Media</option>
                            <option value="Baja">Baja</option>
                            <option value="Muy Baja">Muy Baja</option>
                        </select>
                            <div class="form-error" id="projectPriorityError"></div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectStartDate">Fecha Inicio</label>
                            <input type="date" id="projectStartDate" name="startDate" class="form-control">
                            <div class="form-error" id="projectStartDateError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="projectEndDate">Fecha Fin</label>
                            <input type="date" id="projectEndDate" name="endDate" class="form-control">
                            <div class="form-error" id="projectEndDateError"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="projectStatus">Estado <span class="required">*</span></label>
                            <select id="projectStatus" name="status" class="form-control" required>
                                <option value="">-- Seleccionar Estado --</option>
                                <option value="1">Idea</option>
                                <option value="2">Concepto</option>
                                <option value="3">Viabilidad (TEC-ECO)</option>
                                <option value="4">Dise帽o Detallado</option>
                                <option value="5">Desarrollo</option>
                                <option value="6">Implantado</option>
                                <option value="7">Finalizado</option>
                                <option value="8">On Hold</option>
                                <option value="9">Cancelado</option>
                            </select>
                        <div class="form-error" id="projectStatusError"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeProjectModal()">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="saveProject()">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal-overlay">
        <div class="modal-container delete-modal">
            <div class="modal-header">
                <h2>Confirmar Eliminaci贸n</h2>
                <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="delete-modal-message">驴Est谩 seguro de que desea eliminar el proyecto?</p>
                <span class="delete-modal-project-name" id="deleteProjectName"></span>
                <div class="delete-modal-warning">
                    <span class="delete-modal-warning-icon">锔</span>
                    <div class="delete-modal-warning-text">
                        <strong>Advertencia:</strong> Esta acci贸n no se puede deshacer. Se eliminar谩n todos los datos asociados al proyecto.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">Cancelar</button>
                <button type="button" class="btn btn-danger" onclick="confirmDelete()">Eliminar Proyecto</button>
            </div>
        </div>
    </div>

    <!-- Resource Modal -->
    <div id="resourceModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="resourceModalTitle">A帽adir Recurso</h2>
                <button class="modal-close" onclick="closeResourceModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="resourceForm">
                    <input type="hidden" id="resourceId" name="id">
                    
                    <!-- Hidden field for team (auto-assigned from logged user) -->
                    <input type="hidden" id="resourceTeam" name="team">
                    
                    <div class="form-group">
                        <label for="resourceName">Nombre Completo <span class="required">*</span></label>
                        <input type="text" id="resourceName" name="name" class="form-control" placeholder="Nombre del recurso" required>
                        <small class="form-help">M铆nimo 3 caracteres</small>
                        <div class="form-error" id="resourceNameError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceEmail">Email</label>
                        <input type="email" id="resourceEmail" name="email" class="form-control" placeholder="email@ejemplo.com">
                        <small class="form-help">Email del recurso (opcional)</small>
                        <div class="form-error" id="resourceEmailError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="resourceDefaultCapacity">Capacidad por Defecto (horas/mes) <span class="required">*</span></label>
                        <input type="number" id="resourceDefaultCapacity" name="defaultCapacity" class="form-control" placeholder="160" value="160" required>
                        <small class="form-help">Horas disponibles por mes (por defecto: 160)</small>
                        <div class="form-error" id="resourceDefaultCapacityError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label>Skills / Perfiles</label>
                        <div id="resourceSkillsContainer" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; margin-top: 0.5rem;">
                            <!-- Skills checkboxes will be populated by JavaScript -->
                        </div>
                        <small class="form-help">Selecciona los skills del recurso</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeResourceModal()">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="saveResource()">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Delete Resource Confirmation Modal -->
    <div id="deleteResourceModal" class="modal-overlay">
        <div class="modal-container delete-modal">
            <div class="modal-header">
                <h2>Confirmar Eliminaci贸n</h2>
                <button class="modal-close" onclick="closeDeleteResourceModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="delete-modal-message">驴Est谩 seguro de que desea marcar como inactivo el recurso?</p>
                <span class="delete-modal-project-name" id="deleteResourceName"></span>
                <div class="delete-modal-warning">
                    <span class="delete-modal-warning-icon">锔</span>
                    <div class="delete-modal-warning-text">
                        <strong>Advertencia:</strong> El recurso ser谩 marcado como inactivo y no aparecer谩 en las vistas de capacidad.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeDeleteResourceModal()">Cancelar</button>
                <button type="button" class="btn btn-danger" onclick="confirmDeleteResource()">Marcar como Inactivo</button>
            </div>
        </div>
    </div>

    <!-- Task Details Modal with AG Grid -->
    <div id="taskDetailsModal" class="modal-overlay" style="display: none;">
        <div class="modal-container" style="max-width: 95vw; width: 95vw; max-height: 90vh;">
            <div class="modal-header" style="background: linear-gradient(135deg, #319795 0%, #2c7a7b 100%); color: white; display: flex; align-items: center; gap: 0.75rem;">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 24px; height: 24px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                </svg>
                <h2 id="taskModalTitle" style="flex: 1; margin: 0; font-size: 1.1rem;">Detalle de Tareas</h2>
                <button class="modal-close" onclick="closeTaskDetailsModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 1.5rem; line-height: 1; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>
            <div class="modal-body" style="padding: 1rem; overflow: hidden; display: flex; flex-direction: column; max-height: calc(90vh - 180px);">
                <!-- AG Grid Container -->
                <div id="taskGrid" class="ag-theme-alpine" style="width: 100%; flex: 1; min-height: 400px;"></div>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-top: 1px solid #e2e8f0;">
                <div style="display: flex; gap: 0.75rem;">
                    <button class="btn btn-success" onclick="addTaskRow()" style="display: flex; align-items: center; gap: 0.5rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 18px; height: 18px;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                        A帽adir Fila
                    </button>
                    <button class="btn btn-danger" onclick="deleteSelectedTasks()" style="display: flex; align-items: center; gap: 0.5rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 18px; height: 18px;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                        </svg>
                        Eliminar Seleccionadas
                    </button>
                    <div style="display: flex; align-items: center; gap: 0.5rem; color: #64748b; font-size: 0.875rem; padding: 0 0.75rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                        </svg>
                        Doble clic para editar | Tab/Enter para navegar
                    </div>
                </div>
                <div style="display: flex; gap: 0.75rem;">
                    <button type="button" class="btn btn-secondary" onclick="closeTaskDetailsModal()">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveTaskChanges()" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); border: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 18px; height: 18px; display: inline-block; margin-right: 0.5rem;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                        </svg>
                        Guardar Cambios
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- AG Grid and Task Management Script -->
    <script>
        let taskGridApi;
        let taskGridColumnApi;
        let currentProject = null;

        // Function to open task details modal (make it globally available)
        window.openTaskDetailsModal = function(projectCode, projectTitle, startDate, endDate) {
            console.log('===== openTaskDetailsModal called =====');
            console.log('Params:', { projectCode, projectTitle, startDate, endDate });
            
            currentProject = { code: projectCode, title: projectTitle, startDate, endDate };
            console.log('currentProject set:', currentProject);
            
            // Update modal title
            const titleElement = document.getElementById('taskModalTitle');
            console.log('Title element found:', titleElement);
            if (titleElement) {
                titleElement.textContent = `Detalle de Tareas - ${projectTitle} (${startDate || '---'} - ${endDate || '---'})`;
                console.log('Title updated');
            }
            
            // Show modal
            const modal = document.getElementById('taskDetailsModal');
            console.log('Modal element found:', modal);
            if (modal) {
                modal.style.setProperty('display', 'flex', 'important');
                modal.style.setProperty('opacity', '1', 'important');
                modal.style.setProperty('visibility', 'visible', 'important');
                console.log('Modal display, opacity, and visibility set with !important');
            }
            
            // Check if AG Grid is available
            console.log('AG Grid available:', typeof agGrid);
            
            // Initialize AG Grid
            console.log('Calling initializeTaskGrid...');
            initializeTaskGrid(projectCode);
            console.log('===== openTaskDetailsModal finished =====');
        }

        // Function to close task details modal
        window.closeTaskDetailsModal = function() {
            const modal = document.getElementById('taskDetailsModal');
            if (modal) {
                modal.style.display = 'none';
            }
            currentProject = null;
        }

        // Generate date columns: -30 days to +120 days from today
        function generateDateColumns(startDate, endDate) {
            const columns = [];
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Start 30 days before today
            const start = new Date(today);
            start.setDate(start.getDate() - 30);
            
            // End 120 days after today
            const end = new Date(today);
            end.setDate(end.getDate() + 120);
            
            let currentDate = new Date(start);
            
            while (currentDate <= end) {
                const day = currentDate.getDate();
                const month = currentDate.getMonth() + 1;
                const year = currentDate.getFullYear();
                const dateKey = `${day}/${month}`;
                const isToday = currentDate.getTime() === today.getTime();
                
                columns.push({
                    headerName: dateKey,
                    field: `day_${year}_${month}_${day}`,
                    width: 50,
                    editable: true,
                    headerClass: isToday ? 'ag-header-today' : '',
                    cellStyle: params => {
                        const style = { textAlign: 'center', fontSize: '0.85em' };
                        
                        // Highlight today's column
                        if (isToday) {
                            style.backgroundColor = '#fef3c7';
                            style.borderLeft = '2px solid #f59e0b';
                            style.borderRight = '2px solid #f59e0b';
                        }
                        // Color cells with values
                        else if (params.value && params.value !== '') {
                            style.backgroundColor = '#e6f7ff';
                            style.fontWeight = '500';
                        }
                        
                        return style;
                    }
                });
                
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return columns;
        }

        // Initialize AG Grid
        function initializeTaskGrid(projectCode) {
            // Always use the new date range: -30 to +120 days from today
            const dateColumns = generateDateColumns();

            const columnDefs = [
                {
                    headerName: '',
                    field: 'selected',
                    width: 50,
                    checkboxSelection: true,
                    headerCheckboxSelection: true,
                    pinned: 'left'
                },
                {
                    headerName: 'Tarea',
                    field: 'task',
                    width: 150,
                    editable: true,
                    pinned: 'left',
                    cellStyle: { backgroundColor: '#f8fafc' }
                },
                {
                    headerName: 'Descripci贸n',
                    field: 'description',
                    width: 300,
                    editable: true,
                    pinned: 'left'
                },
                {
                    headerName: 'Equipo',
                    field: 'team',
                    width: 100,
                    editable: true,
                    pinned: 'left'
                },
                ...dateColumns,
                {
                    headerName: 'Total',
                    field: 'total',
                    width: 80,
                    pinned: 'right',
                    editable: false,
                    cellStyle: { 
                        backgroundColor: '#e5e7eb', 
                        fontWeight: 'bold',
                        textAlign: 'center',
                        borderLeft: '2px solid #6b7280'
                    },
                    valueGetter: (params) => {
                        // Sum all day columns
                        let total = 0;
                        for (let key in params.data) {
                            if (key.startsWith('day_') && params.data[key]) {
                                // Extract number from string like "7h" or "7"
                                const value = params.data[key].toString().replace('h', '').trim();
                                const num = parseFloat(value);
                                if (!isNaN(num)) {
                                    total += num;
                                }
                            }
                        }
                        return total > 0 ? `${total}h` : '';
                    }
                }
            ];

            // Log generated columns for debugging
            console.log('Generated date columns:', dateColumns.length);
            console.log('First 5 columns:', dateColumns.slice(0, 5));
            console.log('Last 5 columns:', dateColumns.slice(-5));
            
            // Sample data - empty rows to be filled by user
            const rowData = [
                {
                    task: 'Tarea 1',
                    description: 'Descripci贸n de tarea 1',
                    team: 'Equipo A'
                },
                {
                    task: 'Tarea 2',
                    description: 'Descripci贸n de tarea 2',
                    team: 'Equipo B'
                },
                {
                    task: 'Tarea 3',
                    description: 'Descripci贸n de tarea 3',
                    team: 'Equipo C'
                }
            ];

            const gridOptions = {
                columnDefs: columnDefs,
                rowData: rowData,
                defaultColDef: {
                    sortable: true,
                    filter: true,
                    resizable: true
                },
                rowSelection: 'multiple',
                suppressRowClickSelection: true,
                animateRows: true,
                onGridReady: (params) => {
                    taskGridApi = params.api;
                    taskGridColumnApi = params.columnApi;
                },
                onCellValueChanged: (event) => {
                    console.log('Cell value changed:', event);
                }
            };

            // Initialize grid
            const gridDiv = document.querySelector('#taskGrid');
            new agGrid.Grid(gridDiv, gridOptions);
        }

        // Add new task row (make it globally available)
        window.addTaskRow = function() {
            if (taskGridApi) {
                const newRow = {
                    task: '',
                    description: '',
                    team: ''
                };
                taskGridApi.applyTransaction({ add: [newRow] });
                console.log('New row added');
            }
        }

        // Delete selected tasks (make it globally available)
        window.deleteSelectedTasks = function() {
            if (taskGridApi) {
                const selectedRows = taskGridApi.getSelectedRows();
                if (selectedRows.length === 0) {
                    alert('Por favor, selecciona al menos una tarea para eliminar');
                    return;
                }
                
                if (confirm(`驴Est谩 seguro de eliminar ${selectedRows.length} tarea(s) seleccionada(s)?`)) {
                    taskGridApi.applyTransaction({ remove: selectedRows });
                    console.log('Deleted rows:', selectedRows);
                }
            }
        }

        // Save task changes (make it globally available)
        window.saveTaskChanges = function() {
            if (taskGridApi) {
                const allRows = [];
                taskGridApi.forEachNode(node => allRows.push(node.data));
                
                console.log('Saving tasks for project:', currentProject);
                console.log('Task data:', allRows);
                
                // Here you would typically send the data to your backend API
                alert('Cambios guardados correctamente (funcionalidad en desarrollo)');
                window.closeTaskDetailsModal();
            }
        }

        // Event listener removed - handled by main.js instead
    </script>

    <!-- Modular JavaScript (ES6 Modules) -->
    <script type="module" src="assets/js/main.js"></script>
</body>
</html>
